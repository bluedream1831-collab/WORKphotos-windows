<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²è²¨é€šçŸ¥ç³»çµ± (è‡ªå‹•å­˜æª”ç‰ˆ)</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --primary: #007bff;   /* è—è‰²ï¼šä¸»è¦ */
            --success: #28a745;   /* ç¶ è‰²ï¼šæ–°å¢/è¤‡è£½ */
            --danger: #dc3545;    /* ç´…è‰²ï¼šæ¸…é™¤ */
            --bg: #f4f4f9;
            --card: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
            color: #333;
        }

        .container {
            background-color: var(--card);
            width: 100%;
            max-width: 500px; /* æ‰‹æ©Ÿå¯¬åº¦é©ä¸­ */
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h2 {
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            color: #444;
        }

        .section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .section:last-child { border-bottom: none; }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            color: #555;
        }

        /* --- æ—¥æœŸé¸æ“‡ --- */
        input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            background: #fff;
            box-sizing: border-box;
        }

        /* --- å» å•†åˆ—è¡¨å€ (Gridæ’ç‰ˆ) --- */
        .vendor-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* ä¸€æ’ä¸‰å€‹ */
            gap: 8px;
            margin-bottom: 15px;
        }

        /* éš±è—åŸå§‹ checkbox */
        .vendor-item input { display: none; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .vendor-item label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f0f2f5;
            padding: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
            min-height: 40px;
            border: 2px solid transparent;
            transition: 0.2s;
            position: relative;
            user-select: none;
            word-break: break-word;
        }

        /* é¸ä¸­è®Šè‰² */
        .vendor-item input:checked + label {
            background-color: #e7f1ff;
            border-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }

        /* åˆªé™¤å°æŒ‰éˆ• (åƒ…è‡ªè¨‚å» å•†é¡¯ç¤º) */
        .del-btn {
            font-size: 10px;
            color: #aaa;
            margin-top: 4px;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(0,0,0,0.05);
        }
        .del-btn:hover {
            background: #ffdede;
            color: red;
        }

        /* --- æ–°å¢å» å•†å€ --- */
        .add-box {
            display: flex;
            gap: 8px;
        }
        .add-box input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
        }
        .add-box button {
            background: var(--success);
            color: white;
            border: none;
            padding: 0 15px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }

        /* --- æ–‡å­—é è¦½èˆ‡æ“ä½œå€ --- */
        textarea {
            width: 100%;
            height: 110px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 15px;
            background-color: #fafafa;
            resize: none;
            box-sizing: border-box;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-big {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            color: white;
            transition: opacity 0.2s;
        }
        .btn-big:active { opacity: 0.8; }

        .btn-copy { flex: 2; background-color: var(--primary); }
        .btn-clear { flex: 1; background-color: var(--danger); }

        /* --- æç¤ºæ¡† (Toast) --- */
        .toast {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            color: #fff;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“… éš”æ—¥é€²è²¨é€šçŸ¥</h2>

    <!-- 1. æ—¥æœŸ -->
    <div class="section">
        <label>é€²è²¨æ—¥æœŸ (é è¨­æ˜å¤©)</label>
        <input type="date" id="datePicker">
    </div>

    <!-- 2. å» å•†é¸å–® -->
    <div class="section">
        <label>é»æ“Šé¸æ“‡å» å•†ï¼š</label>
        <div class="vendor-list" id="vendorList">
            <!-- JS å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <!-- æ–°å¢åŠŸèƒ½ -->
        <div class="add-box">
            <input type="text" id="newVendorName" placeholder="è¼¸å…¥æ–°å» å•†åç¨±...">
            <button onclick="addCustomVendor()">ï¼‹ æ–°å¢ä¸¦å­˜æª”</button>
        </div>
    </div>

    <!-- 3. è¨Šæ¯é è¦½ -->
    <div class="section">
        <label>è¨Šæ¯é è¦½ï¼š</label>
        <textarea id="msgBox" readonly></textarea>

        <div class="btn-group">
            <button class="btn-big btn-clear" onclick="clearAll()">âŒ æ¸…é™¤</button>
            <button class="btn-big btn-copy" onclick="copyMsg()">ğŸ“‹ è¤‡è£½ LINE</button>
        </div>
    </div>
</div>

<div id="toast" class="toast">æç¤ºè¨Šæ¯</div>

<script>
    // ==========================================
    // è³‡æ–™è¨­å®š
    // ==========================================
    
    // 1. å›ºå®šå» å•† (ä¸æœƒè¢«åˆªé™¤)
    const fixedVendors = ["å¦‚è¨˜", "çµ±ä¸€å†°å“", "è€é€Ÿè¡ŒéŠ·", "æ³°å®‰", "é—œåŒ—", "ä¸­åŸ", "é è³¼-äº‘å“", "é è³¼-21ä¸–ç´€"];
    
    // 2. è®Šæ•¸
    let customVendors = [];   // ä½¿ç”¨è€…æ–°å¢çš„å» å•† (æœƒå­˜æª”)
    let selectedVendors = []; // ç›®å‰å‹¾é¸çš„å» å•† (ç•¶æ—¥å­˜æª”)

    // DOM å…ƒç´ 
    const elDate = document.getElementById('datePicker');
    const elList = document.getElementById('vendorList');
    const elMsg = document.getElementById('msgBox');
    const elInput = document.getElementById('newVendorName');

    // ==========================================
    // åˆå§‹åŒ–èˆ‡è®€æª”
    // ==========================================
    window.onload = function() {
        initDate();       // è¨­å®šæ—¥æœŸ
        loadFromStorage(); // è®€å–å­˜æª”
        render();         // ç¹ªè£½ç•«é¢
        updateMsg();      // æ›´æ–°æ–‡å­—
    };

    function initDate() {
        const d = new Date();
        d.setDate(d.getDate() + 1); // é è¨­æ˜å¤©
        elDate.value = d.toISOString().split('T')[0];
    }

    // â˜… é‡é»ï¼šè®€å–å­˜æª”åŠŸèƒ½
    function loadFromStorage() {
        // è®€å–ã€Œè‡ªè¨‚å» å•†åå–®ã€
        const savedList = localStorage.getItem('my_custom_vendors_v3');
        if (savedList) {
            customVendors = JSON.parse(savedList);
        }

        // è®€å–ã€Œå‹¾é¸ç‹€æ…‹ã€ (éœ€åˆ¤æ–·æ—¥æœŸ)
        const savedDate = localStorage.getItem('last_date');
        const savedChecks = localStorage.getItem('last_checks');
        
        // å¦‚æœå­˜æª”æ—¥æœŸ == ç•«é¢ä¸Šçš„æ—¥æœŸï¼Œæ‰è¼‰å…¥å‹¾é¸ (å¦å‰‡è¦–ç‚ºéš”å¤©ï¼Œæ¸…ç©ºå‹¾é¸)
        if (savedDate === elDate.value && savedChecks) {
            selectedVendors = JSON.parse(savedChecks);
        } else {
            selectedVendors = []; // æ–°çš„ä¸€å¤©ï¼Œæ¸…ç©º
            saveToStorage();      // æ›´æ–°æ—¥æœŸå­˜æª”
        }
    }

    // â˜… é‡é»ï¼šå¯«å…¥å­˜æª”åŠŸèƒ½
    function saveToStorage() {
        // 1. æ°¸ä¹…å­˜ï¼šè‡ªè¨‚å» å•†åå–®
        localStorage.setItem('my_custom_vendors_v3', JSON.stringify(customVendors));
        
        // 2. æš«æ™‚å­˜ï¼šç›®å‰çš„æ—¥æœŸ èˆ‡ å‹¾é¸ç‹€æ…‹
        localStorage.setItem('last_date', elDate.value);
        localStorage.setItem('last_checks', JSON.stringify(selectedVendors));
    }

    // ==========================================
    // ç•«é¢ç¹ªè£½
    // ==========================================
    function render() {
        let html = '';
        
        // åˆä½µåå–®ï¼šå›ºå®š + è‡ªè¨‚
        const all = [...fixedVendors, ...customVendors];

        all.forEach(name => {
            const isChecked = selectedVendors.includes(name) ? 'checked' : '';
            
            // åˆ¤æ–·æ˜¯å¦ç‚ºè‡ªè¨‚ (ç”¨ä¾†é¡¯ç¤ºåˆªé™¤æŒ‰éˆ•)
            const isCustom = !fixedVendors.includes(name);
            
            // åˆªé™¤æŒ‰éˆ• HTML
            const delBtn = isCustom 
                ? `<div class="del-btn" onclick="deleteVendor(event, '${name}')">åˆªé™¤</div>` 
                : '';

            html += `
                <div class="vendor-item">
                    <input type="checkbox" id="v_${name}" value="${name}" ${isChecked} onchange="toggle('${name}')">
                    <label for="v_${name}">
                        <span>${name}</span>
                        ${delBtn}
                    </label>
                </div>
            `;
        });

        elList.innerHTML = html;
    }

    // ==========================================
    // æ“ä½œé‚è¼¯
    // ==========================================

    // 1. å‹¾é¸/å–æ¶ˆ
    window.toggle = function(name) {
        if (selectedVendors.includes(name)) {
            selectedVendors = selectedVendors.filter(v => v !== name);
        } else {
            selectedVendors.push(name);
        }
        saveToStorage(); // è‡ªå‹•å­˜æª”
        updateMsg();
    }

    // 2. æ–°å¢å» å•† (åŒ…å«è‡ªå‹•å­˜æª”)
    window.addCustomVendor = function() {
        const name = elInput.value.trim();
        if (!name) return showToast("è«‹è¼¸å…¥åç¨±");
        
        // æª¢æŸ¥é‡è¤‡
        if (fixedVendors.includes(name) || customVendors.includes(name)) {
            return showToast("å» å•†å·²å­˜åœ¨");
        }

        customVendors.push(name); // åŠ å…¥åˆ—è¡¨
        saveToStorage();          // â˜… é€™è£¡æœƒè‡ªå‹•å­˜åˆ°æ‰‹æ©Ÿ
        
        elInput.value = '';       // æ¸…ç©ºè¼¸å…¥æ¡†
        render();                 // é‡ç•«æŒ‰éˆ•
        showToast(`å·²æ–°å¢ä¸¦å„²å­˜ï¼š${name}`);
    }

    // 3. åˆªé™¤å» å•†
    window.deleteVendor = function(e, name) {
        e.preventDefault(); // é˜²æ­¢è§¸ç™¼å‹¾é¸
        if (!confirm(`ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤ã€Œ${name}ã€å—ï¼Ÿ`)) return;

        customVendors = customVendors.filter(v => v !== name);
        selectedVendors = selectedVendors.filter(v => v !== name); // è‹¥æœ‰å‹¾é¸ä¹Ÿè¦ç§»é™¤
        
        saveToStorage();
        render();
        updateMsg();
        showToast("å» å•†å·²åˆªé™¤");
    }

    // 4. ä¸€éµæ¸…é™¤å‹¾é¸
    window.clearAll = function() {
        selectedVendors = [];
        
        // è¦–è¦ºæ¸…é™¤
        document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
        
        saveToStorage();
        updateMsg();
        showToast("å·²å…¨éƒ¨æ¸…é™¤");
    }

    // 5. ç”¢ç”Ÿæ–‡å­—è¨Šæ¯
    function updateMsg() {
        const dateStr = elDate.value;
        const dayName = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][new Date(dateStr).getDay()];
        
        const listText = selectedVendors.length > 0 
            ? selectedVendors.join('\n- ') 
            : 'ç„¡';

        elMsg.value = `ã€é€²è²¨é€šçŸ¥ã€‘\næ—¥æœŸï¼š${dateStr} (é€±${dayName})\n\né è¨ˆé€²è²¨å» å•†ï¼š\n- ${listText}\n\nè«‹ç›¸é—œäººå“¡ç•™æ„æ”¶è²¨ã€‚`;
    }

    // 6. è¤‡è£½
    window.copyMsg = function() {
        elMsg.select();
        elMsg.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(elMsg.value)
            .then(() => showToast("è¤‡è£½æˆåŠŸï¼"))
            .catch(() => showToast("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½"));
    }

    // æ—¥æœŸè®Šæ›´ç›£è½
    elDate.addEventListener('change', function() {
        // ç•¶æ‰‹å‹•æ”¹æ—¥æœŸæ™‚ï¼Œä¸è‡ªå‹•æ¸…é™¤å‹¾é¸ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥è£œå–®ï¼Œä½†æœƒæ›´æ–°å­˜æª”æ—¥æœŸ
        localStorage.setItem('last_date', elDate.value);
        updateMsg();
    });

    // é¡¯ç¤ºæç¤º
    function showToast(text) {
        const t = document.getElementById('toast');
        t.textContent = text;
        t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 2000);
    }

</script>

</body>
</html>
