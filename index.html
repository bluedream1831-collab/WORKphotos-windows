<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–ªè³‡åŠ ç­è²»è¨ˆç®—å™¨ (V10.3)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f2f2f7;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 15px;
        }

        .calculator-container {
            background: #ffffff;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
        }

        h1 {
            color: #007aff;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        /* åŠŸèƒ½èˆ‡éš±ç§å®£å‘Šå€å¡Š */
        .feature-notice {
            background-color: #e0f2f1;
            border: 1px solid #b2dfdb;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 0.9em;
            line-height: 1.6;
            color: #00695c;
        }
        .notice-item {
            margin-bottom: 8px;
        }
        .notice-item:last-child {
            margin-bottom: 0;
        }
        .highlight-text {
            font-weight: bold;
            color: #004d40;
            background-color: #b2dfdb;
            padding: 0 4px;
            border-radius: 3px;
        }

        /* é€±æœŸæé†’ */
        .cycle-notice {
            background-color: #fff3e0;
            color: #ef6c00;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9em;
            text-align: center;
            margin-bottom: 25px;
            border: 1px solid #ffe0b2;
            font-weight: bold;
            line-height: 1.5;
        }
        
        h2 {
            color: #1c1c1e;
            font-size: 1.2em;
            font-weight: 700;
            margin: 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f2f2f7;
        }

        .btn-clear {
            background-color: #ff3b30;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn-clear:hover { opacity: 0.8; }

        h3 {
            color: #34c759;
            background-color: #f2fff4;
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 1.05em;
        }

        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 10px;
            flex-wrap: wrap; 
        }

        label {
            flex-basis: 55%;
            font-weight: 600;
            color: #3a3a3c;
            font-size: 0.95em;
            display: flex;
            flex-direction: column; 
        }

        .rate-badge {
            font-size: 0.8em;
            font-weight: normal;
            color: #007aff;
            background-color: #e3f2fd;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
            display: inline-block;
            width: fit-content;
        }

        input[type="number"] {
            flex-basis: 30%;
            padding: 10px;
            border: 1px solid #d1d1d6;
            border-radius: 8px;
            text-align: right;
            font-size: 17px;
            background-color: #fcfcfc;
        }
        
        input[type="number"]::placeholder { color: #c7c7cc; font-size: 0.85em; }
        input[type="number"]:focus { border-color: #007aff; outline: none; background-color: #fff; }

        span {
            flex-basis: 10%;
            text-align: left;
            font-size: 0.9em;
            color: #8e8e93;
        }

        .variable-highlight {
            background-color: #fff9c4;
            border: 1px solid #fbc02d !important;
        }

        .summary-panel {
            background-color: #f0f9ff;
            border: 1px solid #b3e5fc;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.95em;
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .summary-row.main {
            font-weight: bold;
            color: #0277bd;
            border-bottom: 1px solid #b3e5fc;
            padding-bottom: 5px;
            margin-bottom: 8px;
        }

        /* å…¬å¼èªªæ˜åˆ—è¡¨ */
        .formula-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
            font-size: 0.9em;
            color: #555;
        }
        .formula-list li {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        .formula-list li:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .formula-highlight {
            color: #d32f2f;
            font-weight: bold;
            background-color: #ffebee;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .formula-note {
            font-size: 0.85em;
            color: #888;
            margin-top: 4px;
            display: block;
        }

        details {
            background-color: #ffffff;
            border: 1px solid #e5e5ea;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }
        summary {
            padding: 12px;
            cursor: pointer;
            font-weight: 600;
            color: #007aff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f9f9f9;
            list-style: none;
            font-size: 0.95em;
        }
        summary::after { content: '+'; font-size: 1.2em; }
        details[open] summary::after { content: '-'; }
        .details-content { padding: 15px; border-top: 1px solid #e5e5ea; font-size: 0.9em; color: #555; }
        
        .breakdown-table { width: 100%; font-size: 0.9em; border-collapse: collapse; }
        .breakdown-table td { padding: 5px 0; }
        .breakdown-table td:nth-child(2) { text-align: right; font-family: monospace; font-size: 1.1em; color: #ff3b30; }

        .checkbox-container {
            flex-basis: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-top: 8px;
            font-size: 0.9em;
            color: #666;
        }
        .checkbox-container input { margin-right: 8px; width: 20px; height: 20px; }

        .result-area {
            margin-top: 30px;
            padding: 20px;
            background: #fff8f8;
            border: 1px solid #ffccd5;
            border-radius: 12px;
            text-align: center;
        }
        .result-area p {
            font-size: 2.5em;
            font-weight: 800;
            color: #d32f2f;
            margin: 5px 0 15px 0;
        }

        .total-hours-display {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
            padding: 8px;
            background-color: #fff;
            border-radius: 8px;
            display: inline-block;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .hours-check-section {
            background-color: #fff;
            border: 2px dashed #c7c7cc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
        }
        .warning-text {
            background-color: #ffebee;
            color: #c62828;
            font-weight: bold;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    
    <div class="calculator-container">
        <h1>è–ªè³‡åŠ ç­è²»è¨ˆç®—å™¨ (V10.3)</h1>
        
        <!-- è‡ªå‹•è¨˜æ†¶ & éš±ç§å®£å‘Š -->
        <div class="feature-notice">
            <div class="notice-item">
                ğŸ’¾ <strong>è‡ªå‹•è¨˜æ†¶åŠŸèƒ½ï¼š</strong><br>
                æ‚¨è¼¸å…¥çš„è³‡æ–™æœƒ<span class="highlight-text">è‡ªå‹•å„²å­˜</span>ï¼Œä¸‹æ¬¡é–‹å•Ÿç¶²é æ™‚æ•¸å­—é‚„åœ¨ï¼Œä¸ç”¨é‡æ–°è¼¸å…¥ã€‚
            </div>
            <div class="notice-item" style="margin-top:10px; border-top:1px dashed #b2dfdb; padding-top:10px;">
                ğŸ”’ <strong>éš±ç§å®‰å…¨ä¿è­·ï¼š</strong><br>
                æ‰€æœ‰è³‡æ–™åƒ…å„²å­˜åœ¨<span class="highlight-text">æ‚¨çš„æ‰‹æ©Ÿ/é›»è…¦</span>ä¸­ï¼Œ<br>
                çµ•å°ä¸æœƒä¸Šå‚³é›²ç«¯ï¼Œä»–äººç„¡æ³•æŸ¥çœ‹ã€‚
            </div>
        </div>

        <!-- é€±æœŸæé†’ -->
        <div class="cycle-notice">
            ğŸ“… è¨ˆè–ªé€±æœŸæé†’ï¼š<br>
            ä¸Šæœˆ21æ—¥ è‡³ ç•¶æœˆ20æ—¥<br>
            <span style="font-weight:normal; font-size:0.9em; display:block; margin-top:5px; color:#555;">
                (æ¯æœˆ20æ—¥å¾Œï¼Œè«‹æŒ‰ä¸‹æ–¹ã€Œæ¸…ç©ºæ™‚æ•¸ã€é‡æ–°è¨ˆç®—)
            </span>
        </div>

        <!-- æœˆè–ªè¼¸å…¥å€ -->
        <div class="section-header">
            <h2>ğŸ’° æœˆè–ªçµæ§‹ (è¨ˆç®—åŸºç¤)</h2>
        </div>
        
        <div class="input-group" style="margin-top: 15px;">
            <label for="baseSalary">æœ¬ä¿¸</label>
            <input type="number" id="baseSalary" placeholder="è«‹å¡«å¯«æœ¬ä¿¸" min="0">
            <span>å…ƒ</span>
        </div>
        <div class="input-group">
            <label for="mealAllowance">ä¼™é£Ÿæ´¥è²¼</label>
            <input type="number" id="mealAllowance" value="3000" min="0">
            <span>å…ƒ</span>
        </div>
        <div class="input-group">
            <label for="transportAllowance">äº¤é€šæ´¥è²¼</label>
            <input type="number" id="transportAllowance" value="1000" min="0">
            <span>å…ƒ</span>
        </div>
        <div class="input-group">
            <label for="freezerAllowance">å†·å‡æ´¥è²¼</label>
            <input type="number" id="freezerAllowance" value="4000" min="0">
            <span>å…ƒ</span>
        </div>
        <div class="input-group">
            <label for="pickingBonus" style="color: #f57c00;">ç†è²¨çé‡‘ (è®Šå‹•)</label>
            <input type="number" id="pickingBonus" value="3000" min="0" class="variable-highlight">
            <span>å…ƒ</span>
        </div>

        <!-- å³æ™‚åŸºç¤æ™‚è–ªé¡¯ç¤ºé¢æ¿ -->
        <div class="summary-panel">
            <div class="summary-row main">
                <span>æœˆè–ªç¸½é¡ (å«æ´¥è²¼/çé‡‘)</span>
                <span id="displayTotalBase">0 å…ƒ</span>
            </div>
            <div class="summary-row">
                <span>å¹³æ—¥æ¯å°æ™‚å·¥è³‡ (Ã·240)</span>
                <span id="displayHourlyRate" style="font-weight:bold; color:#d32f2f;">0 å…ƒ</span>
            </div>
            <div style="font-size:0.8em; color:#666; margin-top:5px; text-align:right;">
                * æ‰€æœ‰åŠ ç­è²»å°‡ä»¥æ­¤æ™‚è–ªç‚ºåŸºæº–ä¹˜ç®—å€ç‡
            </div>
        </div>

        <!-- å…¬å¼èªªæ˜ -->
        <details>
            <summary>ğŸ“˜ é»æ­¤æŸ¥çœ‹ï¼šè¨ˆç®—å…¬å¼èªªæ˜</summary>
            <div class="details-content">
                <ul class="formula-list">
                    <li>
                        <strong>1. åŸºç¤æ™‚è–ª (å¹³æ—¥æ¯å°æ™‚å·¥è³‡)</strong><br>
                        è¨ˆç®—å¼ï¼š<span class="formula-highlight">æœˆè–ªç¸½é¡ Ã· 240</span>
                        <span class="formula-note">è¨»ï¼š240 ç‚ºé€šç”¨ä¹‹æœˆå·¥æ™‚æ¨ç®—åŸºæ•¸ (30å¤© Ã— 8å°æ™‚)ã€‚æœˆè–ªç¸½é¡åŒ…å«æœ¬ä¿¸ã€æ´¥è²¼åŠå›ºå®šç™¼æ”¾ä¹‹çé‡‘ã€‚</span>
                    </li>
                    <li>
                        <strong>2. å¹³æ—¥åŠ ç­è²»ç‡</strong><br>
                        å‰2å°æ™‚ï¼š<span class="formula-highlight">æ™‚è–ª Ã— 1.34 (4/3)</span><br>
                        ç¬¬3å°æ™‚èµ·ï¼š<span class="formula-highlight">æ™‚è–ª Ã— 1.67 (5/3)</span>
                    </li>
                    <li>
                        <strong>3. ä¼‘æ¯æ—¥åŠ ç­è²»ç‡ (é€±å…­)</strong><br>
                        å‰2å°æ™‚ï¼š<span class="formula-highlight">æ™‚è–ª Ã— 1.34 (4/3)</span><br>
                        ç¬¬3-8å°æ™‚ï¼š<span class="formula-highlight">æ™‚è–ª Ã— 1.67 (5/3)</span><br>
                        ç¬¬9å°æ™‚èµ·ï¼š<span class="formula-highlight">æ™‚è–ª Ã— 2.67 (8/3)</span>
                    </li>
                </ul>
            </div>
        </details>
        
        <!-- åŠ ç­æ™‚æ•¸è¼¸å…¥å€ -->
        <div class="section-header">
            <h2>â±ï¸ åŠ ç­æ™‚æ•¸è¼¸å…¥</h2>
            <button onclick="clearHours()" class="btn-clear">ğŸ—‘ï¸ æ¸…ç©ºæ™‚æ•¸</button>
        </div>
        
        <h3>ğŸ’¼ å¹³æ—¥åŠ ç­ (è¨ˆå…¥ 46H)</h3>
        <div class="input-group">
            <label>
                å‰2å°æ™‚ (1.34å€)
                <span id="rateLabel_134" class="rate-badge">ç›®å‰ $0/æ™‚</span>
            </label>
            <input type="number" id="normalOT1" placeholder="0" min="0">
            <span>å°æ™‚</span>
        </div>
        <div class="input-group">
            <label>
                ç¬¬3å°æ™‚èµ· (1.67å€)
                <span id="rateLabel_167" class="rate-badge">ç›®å‰ $0/æ™‚</span>
            </label>
            <input type="number" id="normalOT2" placeholder="0" min="0">
            <span>å°æ™‚</span>
        </div>
        
        <h3>ğŸ—“ï¸ ä¼‘æ¯æ—¥åŠ ç­ (è¨ˆå…¥ 46H)</h3>
        <div class="input-group">
            <label>
                å‰2å°æ™‚ (1.34å€)
                <span id="rateLabel_dayOff1" class="rate-badge">ç›®å‰ $0/æ™‚</span>
            </label>
            <input type="number" id="dayOffOT1" placeholder="0" min="0">
            <span>å°æ™‚</span>
        </div>
        <div class="input-group">
            <label>
                ç¬¬3-8å°æ™‚ (1.67å€)
                <span id="rateLabel_dayOff2" class="rate-badge">ç›®å‰ $0/æ™‚</span>
            </label>
            <input type="number" id="dayOffOT2" placeholder="0" min="0">
            <span>å°æ™‚</span>
        </div>
        <div class="input-group">
            <label>
                ç¬¬9å°æ™‚èµ· (2.67å€)
                <span id="rateLabel_dayOff3" class="rate-badge">ç›®å‰ $0/æ™‚</span>
            </label>
            <input type="number" id="dayOffOT3" placeholder="0" min="0">
            <span>å°æ™‚</span>
        </div>
        
        <h3>ğŸ‰ ç‰¹æ®ŠåŠ ç­</h3>
        <div class="input-group">
            <label>åœ‹å®šå‡æ—¥ (æ›ä¼‘)</label>
            <input type="number" id="holidayOT" placeholder="0" min="0">
            <span>å°æ™‚</span>
            <div class="checkbox-container">
                <input type="checkbox" id="countHolidayInLimit">
                <label for="countHolidayInLimit">å‹¾é¸è¨ˆå…¥46Hä¸Šé™</label>
            </div>
        </div>
        <div class="input-group" style="margin-top:10px;">
            <label>å¤©ç½/äº‹è®Š (æ›ä¼‘)</label>
            <input type="number" id="disasterOT" placeholder="0" min="0">
            <span>å°æ™‚</span>
        </div>

        <!-- çµæœé¡¯ç¤º -->
        <div class="result-area">
            <h2>ğŸ’µ é ä¼°ç¸½æ”¶å…¥</h2>

            <div class="total-hours-display">
                ç¸½åŠ ç­æ™‚æ•¸ï¼š<span id="totalHoursAll" style="color:#007aff; font-weight:bold;">0</span> å°æ™‚
            </div>

            <p id="totalIncome">0 å…ƒ</p>
            
            <div style="font-weight:bold; color:#555; text-align:center; font-size: 0.9em;">
                åŸºæœ¬æœˆè–ª <span id="monthlyBasePay" style="color:#007aff;">0</span>
                + åŠ ç­è²» <span id="totalPay" style="color:#ff3b30;">0</span>
            </div>

            <details>
                <summary>ğŸ§® æŸ¥çœ‹è©³ç´°è¨ˆç®—éç¨‹</summary>
                <div class="details-content">
                    <table class="breakdown-table">
                        <tr><td>å¹³æ—¥å‰2H (1.34)ï¼š</td><td id="bd_n1">0 x $0 = 0</td></tr>
                        <tr><td>å¹³æ—¥å¾ŒçºŒ (1.67)ï¼š</td><td id="bd_n2">0 x $0 = 0</td></tr>
                        <tr><td>ä¼‘æ¯æ—¥å‰2H (1.34)ï¼š</td><td id="bd_d1">0 x $0 = 0</td></tr>
                        <tr><td>ä¼‘æ¯æ—¥3-8H (1.67)ï¼š</td><td id="bd_d2">0 x $0 = 0</td></tr>
                        <tr><td>ä¼‘æ¯æ—¥9Hèµ· (2.67)ï¼š</td><td id="bd_d3">0 x $0 = 0</td></tr>
                        <tr style="border-top: 1px solid #ccc;"><td><strong>åŠ ç­è²»ç¸½è¨ˆï¼š</strong></td><td id="bd_total"><strong>0</strong></td></tr>
                    </table>
                </div>
            </details>

            <div class="hours-check-section">
                <div class="check-row" style="border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-bottom: 10px;">
                    <span>ğŸ“œ 46H ä¸Šé™æª¢æ ¸ï¼š</span>
                    <span class="check-value" id="remainingHours" style="color: #34c759;">å‰©é¤˜ 46.0 å°æ™‚</span>
                </div>
                <div class="check-row" style="font-size: 0.9em; color:#666;">
                    <span>å·²ç”¨å—é™æ™‚æ•¸ï¼š</span>
                    <span id="usedLimitedHours">0 å°æ™‚</span>
                </div>
                <div id="warningMessage" class="warning-text">âš ï¸ æ³¨æ„ï¼šå—é™æ™‚æ•¸å·²çˆ†è¡¨ï¼</div>
            </div>
        </div>
    </div>

    <script>
        // V10.3: é€šç”¨æ¨™æº–å€ç‡ä¿‚æ•¸ (ä¸ä½¿ç”¨ç‰¹å®šæ³•è¦å­—çœ¼)
        const MULTIPLIERS = {
            RATE_134: 4/3, 
            RATE_167: 5/3, 
            RATE_267: 8/3  
        };

        const inputIds = [
            'baseSalary', 'mealAllowance', 'transportAllowance', 'freezerAllowance', 'pickingBonus',
            'normalOT1', 'normalOT2',
            'dayOffOT1', 'dayOffOT2', 'dayOffOT3',
            'holidayOT', 'disasterOT'
        ];

        const hourInputIds = [
            'normalOT1', 'normalOT2',
            'dayOffOT1', 'dayOffOT2', 'dayOffOT3',
            'holidayOT', 'disasterOT'
        ];

        // æ²¿ç”¨ Key ç¢ºä¿å‡ç´šå¾Œè³‡æ–™é‚„åœ¨
        const STORAGE_KEY = 'salary_calc_personal_v10';

        function calculate() {
            // A. è¨ˆç®—æœˆè–ªç¸½é¡
            const baseSalary = parseFloat(document.getElementById('baseSalary').value) || 0;
            const mealAllowance = parseFloat(document.getElementById('mealAllowance').value) || 0;
            const transportAllowance = parseFloat(document.getElementById('transportAllowance').value) || 0;
            const freezerAllowance = parseFloat(document.getElementById('freezerAllowance').value) || 0;
            const pickingBonus = parseFloat(document.getElementById('pickingBonus').value) || 0;
            
            const monthlyTotal = Math.round(baseSalary + mealAllowance + transportAllowance + freezerAllowance + pickingBonus);

            // B. è¨ˆç®—å¹³æ—¥æ¯å°æ™‚å·¥è³‡ (é€šç”¨æ¨™æº–ï¼šæœˆè–ª / 240)
            const hourlyRateRaw = monthlyTotal / 240;
            const hourlyRateDisplay = hourlyRateRaw.toFixed(2);

            // C. è¨ˆç®—å„éšæ®µåŠ ç­è²»ç‡
            const rate134 = Math.round(hourlyRateRaw * MULTIPLIERS.RATE_134);
            const rate167 = Math.round(hourlyRateRaw * MULTIPLIERS.RATE_167);
            const rate267 = Math.round(hourlyRateRaw * MULTIPLIERS.RATE_267);

            document.getElementById('displayTotalBase').innerText = `${monthlyTotal.toLocaleString()} å…ƒ`;
            document.getElementById('displayHourlyRate').innerText = `${hourlyRateDisplay} å…ƒ`;

            document.getElementById('rateLabel_134').innerText = `ç›®å‰ $${rate134}/æ™‚`;
            document.getElementById('rateLabel_167').innerText = `ç›®å‰ $${rate167}/æ™‚`;
            document.getElementById('rateLabel_dayOff1').innerText = `ç›®å‰ $${rate134}/æ™‚`;
            document.getElementById('rateLabel_dayOff2').innerText = `ç›®å‰ $${rate167}/æ™‚`;
            document.getElementById('rateLabel_dayOff3').innerText = `ç›®å‰ $${rate267}/æ™‚`;

            // D. å–å¾—æ™‚æ•¸
            const n1 = parseFloat(document.getElementById('normalOT1').value) || 0;
            const n2 = parseFloat(document.getElementById('normalOT2').value) || 0;
            const d1 = parseFloat(document.getElementById('dayOffOT1').value) || 0;
            const d2 = parseFloat(document.getElementById('dayOffOT2').value) || 0;
            const d3 = parseFloat(document.getElementById('dayOffOT3').value) || 0;
            const hol = parseFloat(document.getElementById('holidayOT').value) || 0; 
            const dis = parseFloat(document.getElementById('disasterOT').value) || 0;

            const totalHoursAll = n1 + n2 + d1 + d2 + d3 + hol + dis;
            document.getElementById('totalHoursAll').innerText = totalHoursAll.toFixed(1);

            // E. è¨ˆç®—åŠ ç­è²»ç¸½é¡
            const p_n1 = n1 * rate134;
            const p_n2 = n2 * rate167;
            const p_d1 = d1 * rate134;
            const p_d2 = d2 * rate167;
            const p_d3 = d3 * rate267;
            
            const totalOTPay = Math.round(p_n1 + p_n2 + p_d1 + p_d2 + p_d3);
            const totalIncome = monthlyTotal + totalOTPay;

            // F. æ›´æ–°çµæœå€
            document.getElementById('monthlyBasePay').innerText = `${monthlyTotal.toLocaleString()} å…ƒ`;
            document.getElementById('totalPay').innerText = `${totalOTPay.toLocaleString()} å…ƒ`;
            document.getElementById('totalIncome').innerText = `${totalIncome.toLocaleString()} å…ƒ`;

            // æ›´æ–°è©³ç´°ç®—å¼
            updateBreakdown('bd_n1', n1, rate134, p_n1);
            updateBreakdown('bd_n2', n2, rate167, p_n2);
            updateBreakdown('bd_d1', d1, rate134, p_d1);
            updateBreakdown('bd_d2', d2, rate167, p_d2);
            updateBreakdown('bd_d3', d3, rate267, p_d3);
            document.getElementById('bd_total').innerText = `$ ${totalOTPay.toLocaleString()}`;

            // G. 46H æª¢æ ¸
            checkLaborLimit(n1, n2, d1, d2, d3, hol, dis);

            saveData();
        }

        function clearHours() {
            if (confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ™‚æ•¸å—ï¼Ÿ\n(æ¯æœˆ20æ—¥å¾Œè«‹åŸ·è¡Œæ­¤å‹•ä½œï¼Œè–ªè³‡è¨­å®šå°‡ä¿ç•™)")) {
                hourInputIds.forEach(id => {
                    document.getElementById(id).value = '';
                });
                calculate();
            }
        }

        function updateBreakdown(elementId, hours, rate, subtotal) {
            const el = document.getElementById(elementId);
            if (hours > 0) {
                el.innerHTML = `${hours} <small>h</small> Ã— $${rate} = <b>$${subtotal.toLocaleString()}</b>`;
                el.style.color = '#333';
            } else {
                el.innerHTML = `<span style="color:#ccc">0 <small>h</small> Ã— $${rate} = 0</span>`;
            }
        }

        function checkLaborLimit(n1, n2, d1, d2, d3, hol, dis) {
            let limited = n1 + n2 + d1 + d2 + d3;
            if(document.getElementById('countHolidayInLimit').checked) {
                limited += hol;
            }
            const remaining = 46 - limited;
            
            document.getElementById('usedLimitedHours').innerText = `${limited.toFixed(1)} å°æ™‚`;
            const remEl = document.getElementById('remainingHours');
            const warnEl = document.getElementById('warningMessage');

            if (remaining >= 0) {
                remEl.innerText = `å‰©é¤˜ ${remaining.toFixed(1)} å°æ™‚`;
                remEl.style.color = '#34c759';
                warnEl.style.display = 'none';
            } else {
                remEl.innerText = `å·²è¶…é¡ ${(Math.abs(remaining)).toFixed(1)} å°æ™‚`;
                remEl.style.color = '#ff3b30';
                warnEl.style.display = 'block';
            }
        }

        function saveData() {
            const data = {};
            inputIds.forEach(id => data[id] = document.getElementById(id).value);
            data['countHolidayInLimit'] = document.getElementById('countHolidayInLimit').checked;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const data = JSON.parse(savedData);
                inputIds.forEach(id => {
                    if (data[id] !== undefined && data[id] !== "") {
                        document.getElementById(id).value = data[id];
                    }
                });
                if (data['countHolidayInLimit'] !== undefined) {
                    document.getElementById('countHolidayInLimit').checked = data['countHolidayInLimit'];
                }
            }
        }

        inputIds.forEach(id => document.getElementById(id).addEventListener('input', calculate));
        document.getElementById('countHolidayInLimit').addEventListener('change', calculate);

        window.onload = function() {
            loadData();
            calculate();
        };
    </script>
</body>
</html>
