<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²è²¨é€šçŸ¥ç”¢ç”Ÿå™¨ (é€²éšç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #007bff;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --bg-color: #f4f4f9;
            --card-bg: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 600px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .control-group {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .control-group:last-child {
            border-bottom: none;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }

        input[type="date"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: #fff;
            box-sizing: border-box;
        }

        /* --- å» å•†åˆ—è¡¨æ¨£å¼ --- */
        .vendor-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); /* æ‰‹æ©Ÿç‰ˆè‡ªå‹•æ’åˆ— */
            gap: 8px;
            margin-bottom: 15px;
        }

        .vendor-item input[type="checkbox"] {
            display: none;
        }

        .vendor-item label {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f1f1f1;
            padding: 10px 5px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            font-weight: normal;
            font-size: 14px;
            transition: all 0.2s;
            border: 2px solid transparent;
            user-select: none;
            min-height: 44px; /* æ‰‹æ©Ÿå¥½æŒ‰çš„é«˜åº¦ */
            word-break: break-word;
        }

        /* é¸ä¸­ç‹€æ…‹ */
        .vendor-item input[type="checkbox"]:checked + label {
            background-color: #e6f2ff;
            border-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        /* --- æ–°å¢å» å•†å€åŸŸ --- */
        .add-vendor-area {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .add-vendor-area input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .btn-add {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 0 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .delete-btn {
            font-size: 10px;
            color: #999;
            margin-left: 5px;
            cursor: pointer;
        }

        /* --- æŒ‰éˆ•ç¾¤çµ„ --- */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        button {
            font-size: 16px;
            padding: 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        button:active {
            opacity: 0.8;
        }

        .btn-copy {
            flex: 2;
            background-color: var(--primary-color);
            color: white;
        }

        .btn-clear {
            flex: 1;
            background-color: var(--danger-color);
            color: white;
        }

        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            resize: none;
            box-sizing: border-box;
            background-color: #fafafa;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“… é€²è²¨é€šçŸ¥å°å¹«æ‰‹</h2>

    <!-- æ—¥æœŸé¸æ“‡ -->
    <div class="control-group">
        <label for="datePicker">é€²è²¨æ—¥æœŸï¼š</label>
        <input type="date" id="datePicker">
    </div>

    <!-- å» å•†åˆ—è¡¨ -->
    <div class="control-group">
        <label>é»æ“Šé¸æ“‡å» å•†ï¼š</label>
        <div class="vendor-list" id="vendorContainer">
            <!-- JS è‡ªå‹•ç”Ÿæˆ -->
        </div>

        <!-- è‡ªè¡Œæ–°å¢å» å•† -->
        <label style="margin-top:15px; font-size: 14px;">ï¼‹ æ–°å¢å…¶ä»–å» å•†ï¼š</label>
        <div class="add-vendor-area">
            <input type="text" id="newVendorInput" placeholder="è¼¸å…¥å» å•†åç¨±">
            <button class="btn-add" onclick="addNewVendor()">æ–°å¢</button>
        </div>
    </div>

    <!-- è¨Šæ¯èˆ‡æŒ‰éˆ• -->
    <div class="control-group">
        <label>è¨Šæ¯é è¦½ï¼š</label>
        <textarea id="messageOutput" readonly></textarea>
        
        <div class="action-buttons">
            <button class="btn-clear" onclick="clearSelection()">âŒ æ¸…é™¤é¸å–</button>
            <button class="btn-copy" onclick="copyText()">ğŸ“‹ è¤‡è£½è¨Šæ¯</button>
        </div>
    </div>
</div>

<div id="toast" class="toast">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼</div>

<script>
    // ==========================================
    // 1. åˆå§‹è¨­å®šèˆ‡è³‡æ–™
    // ==========================================
    
    // é è¨­å›ºå®šå» å•† (ä½¿ç”¨è€…ä¸å¯åˆªé™¤ï¼Œé™¤éæ”¹ç¨‹å¼ç¢¼)
    const defaultVendors = [
        "å¦‚è¨˜", 
        "çµ±ä¸€å†°å“", 
        "è€é€Ÿè¡ŒéŠ·", 
        "æ³°å®‰", 
        "é—œåŒ—", 
        "ä¸­åŸ", 
        "é è³¼-äº‘å“", 
        "é è³¼-21ä¸–ç´€"
    ];

    // DOM å…ƒç´ 
    const datePicker = document.getElementById('datePicker');
    const vendorContainer = document.getElementById('vendorContainer');
    const messageOutput = document.getElementById('messageOutput');
    const newVendorInput = document.getElementById('newVendorInput');

    // ç‹€æ…‹è®Šæ•¸
    let customVendors = [];   // ä½¿ç”¨è€…è‡ªè¨‚çš„å» å•†
    let selectedVendors = []; // ç›®å‰è¢«å‹¾é¸çš„å» å•†åç¨±

    // ==========================================
    // 2. ç¨‹å¼å•Ÿå‹•é‚è¼¯ (è®€å–èˆ‡åˆå§‹åŒ–)
    // ==========================================
    window.onload = function() {
        initDate();        // 1. è¨­å®šæ—¥æœŸ
        loadData();        // 2. è®€å–å­˜æª” (è‡ªè¨‚å» å•† + å‹¾é¸ç‹€æ…‹)
        renderVendors();   // 3. ç•«å‡ºç•«é¢
        updateMessage();   // 4. æ›´æ–°æ–‡å­—
    };

    // åˆå§‹åŒ–æ—¥æœŸ (é è¨­æ˜å¤©)
    function initDate() {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const yyyy = tomorrow.getFullYear();
        const mm = String(tomorrow.getMonth() + 1).padStart(2, '0');
        const dd = String(tomorrow.getDate()).padStart(2, '0');
        
        // é€™è£¡å…ˆè¨­å®š input çš„å€¼
        datePicker.value = `${yyyy}-${mm}-${dd}`;
    }

    // ==========================================
    // 3. è³‡æ–™å„²å­˜èˆ‡è®€å–é‚è¼¯ (LocalStorage)
    // ==========================================
    
    function loadData() {
        // A. è®€å–è‡ªè¨‚å» å•†åå–®
        const savedCustom = localStorage.getItem('custom_vendors');
        if (savedCustom) {
            customVendors = JSON.parse(savedCustom);
        }

        // B. è®€å–ä¸Šæ¬¡å‹¾é¸ç‹€æ…‹ (å«éš”æ—¥æ¸…é™¤é‚è¼¯)
        const savedDate = localStorage.getItem('saved_date');
        const savedSelection = localStorage.getItem('selected_vendors');
        const currentDate = datePicker.value; // å‰›å‰›ç®—å‡ºä¾†çš„ã€Œæ˜å¤©ã€

        // é‚è¼¯ï¼šå¦‚æœã€Œå­˜æª”çš„æ—¥æœŸã€è·Ÿã€Œç¾åœ¨ç®—å‡ºä¾†çš„æ—¥æœŸã€ä¸€æ¨£ï¼Œä»£è¡¨æ˜¯åŒä¸€å¤©çš„å·¥ä½œï¼Œå°±è¼‰å…¥å‹¾é¸
        // å¦‚æœä¸ä¸€æ¨£ (ä»£è¡¨éäº†ä¸€å¤©ï¼Œæˆ–è€…æ›æ—¥äº†)ï¼Œå°±ä¸è¼‰å…¥å‹¾é¸ (ç­‰åŒæ–¼æ¸…é™¤)
        if (savedDate === currentDate && savedSelection) {
            selectedVendors = JSON.parse(savedSelection);
        } else {
            selectedVendors = []; // ä¸åŒå¤©ï¼Œæ¸…ç©ºå‹¾é¸
            // æ›´æ–°å­˜æª”æ—¥æœŸç‚ºä»Šå¤©é¡¯ç¤ºçš„æ—¥æœŸ
            localStorage.setItem('saved_date', currentDate);
            localStorage.setItem('selected_vendors', JSON.stringify([]));
        }
    }

    function saveData() {
        // 1. å„²å­˜è‡ªè¨‚å» å•†æ¸…å–®
        localStorage.setItem('custom_vendors', JSON.stringify(customVendors));
        
        // 2. å„²å­˜ç›®å‰çš„å‹¾é¸ç‹€æ…‹èˆ‡æ—¥æœŸ
        localStorage.setItem('saved_date', datePicker.value);
        localStorage.setItem('selected_vendors', JSON.stringify(selectedVendors));
    }

    // ==========================================
    // 4. æ¸²æŸ“èˆ‡äº’å‹•é‚è¼¯
    // ==========================================

    // ç•«å‡ºæ‰€æœ‰å» å•†æŒ‰éˆ•
    function renderVendors() {
        vendorContainer.innerHTML = '';
        
        // åˆä½µé è¨­å’Œè‡ªè¨‚åå–®
        const allVendors = [...defaultVendors, ...customVendors];

        allVendors.forEach((name, index) => {
            // æª¢æŸ¥æ˜¯å¦åœ¨å·²é¸åå–®ä¸­
            const isChecked = selectedVendors.includes(name) ? 'checked' : '';
            
            // åˆ¤æ–·æ˜¯å¦ç‚ºè‡ªè¨‚å» å•† (ç”¨ä¾†æ±ºå®šè¦ä¸è¦é¡¯ç¤ºåˆªé™¤å°æŒ‰éˆ•)
            const isCustom = index >= defaultVendors.length;
            const deleteBtnHtml = isCustom 
                ? `<span class="delete-btn" onclick="removeCustomVendor('${name}'); event.preventDefault();">âœ•</span>` 
                : '';

            const html = `
                <div class="vendor-item">
                    <input type="checkbox" id="v_${index}" value="${name}" ${isChecked} onchange="toggleVendor('${name}')">
                    <label for="v_${index}">
                        ${name}
                        ${deleteBtnHtml}
                    </label>
                </div>
            `;
            vendorContainer.insertAdjacentHTML('beforeend', html);
        });
    }

    // å‹¾é¸/å–æ¶ˆå‹¾é¸
    window.toggleVendor = function(name) {
        const idx = selectedVendors.indexOf(name);
        if (idx > -1) {
            selectedVendors.splice(idx, 1); // ç§»é™¤
        } else {
            selectedVendors.push(name); // æ–°å¢
        }
        saveData(); // ç«‹å³å­˜æª”
        updateMessage();
    }

    // æ–°å¢è‡ªè¨‚å» å•†
    window.addNewVendor = function() {
        const name = newVendorInput.value.trim();
        if (!name) return;
        
        if (defaultVendors.includes(name) || customVendors.includes(name)) {
            showToast("å» å•†å·²å­˜åœ¨ï¼");
            return;
        }

        customVendors.push(name);
        newVendorInput.value = '';
        
        saveData();
        renderVendors();
        // è‡ªå‹•å¹«å¿™å‹¾é¸å‰›æ–°å¢çš„
        // toggleVendor(name); // å¦‚æœä¸æƒ³è‡ªå‹•å‹¾é¸ï¼Œé€™è¡Œè¨»è§£æ‰
    }

    // ç§»é™¤è‡ªè¨‚å» å•†
    window.removeCustomVendor = function(name) {
        // é˜²æ­¢è§¸ç™¼ checkbox
        event.stopPropagation(); 
        
        if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${name}ã€å—ï¼Ÿ`)) {
            // å¾è‡ªè¨‚åå–®ç§»é™¤
            customVendors = customVendors.filter(v => v !== name);
            // å¦‚æœåŸæœ¬æœ‰å‹¾é¸ï¼Œä¹Ÿè¦ç§»é™¤
            selectedVendors = selectedVendors.filter(v => v !== name);
            
            saveData();
            renderVendors();
            updateMessage();
        }
    }

    // ä¸€éµæ¸…é™¤é¸å–
    window.clearSelection = function() {
        selectedVendors = [];
        
        // è¦–è¦ºä¸Šå–æ¶ˆæ‰€æœ‰ checkbox
        const checkboxes = document.querySelectorAll('.vendor-list input[type="checkbox"]');
        checkboxes.forEach(box => box.checked = false);
        
        saveData();
        updateMessage();
        showToast("å·²æ¸…é™¤æ‰€æœ‰å‹¾é¸");
    }

    // ç›£è½æ—¥æœŸè®Šæ›´
    datePicker.addEventListener('change', function() {
        // æ—¥æœŸè®Šæ›´æ™‚ï¼Œæˆ‘å€‘é¸æ“‡ã€Œä¸ã€è‡ªå‹•æ¸…é™¤å‹¾é¸ï¼Œ
        // è®“ä½¿ç”¨è€…å¯ä»¥æ–¹ä¾¿åœ°é¸å¥½å¾Œæ”¹æ—¥æœŸï¼Œæˆ–è€…æ”¹æ—¥æœŸå¾Œè£œé¸ã€‚
        // ä½†è¦æ›´æ–°å­˜æª”æ—¥æœŸï¼Œé¿å…é‡æ•´å¾Œè¢«ç•¶ä½œã€Œéš”å¤©ã€æ¸…æ‰
        localStorage.setItem('saved_date', datePicker.value);
        updateMessage();
    });

    // å–å¾—æ˜ŸæœŸå¹¾
    function getDayName(dateString) {
        const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        const d = new Date(dateString);
        return days[d.getDay()];
    }

    // æ›´æ–°è¨Šæ¯å…§å®¹
    function updateMessage() {
        const dateVal = datePicker.value;
        const dayName = getDayName(dateVal);
        
        const vendorText = selectedVendors.length > 0 ? selectedVendors.join('\n- ') : 'ç„¡';

        const finalMessage = `ã€é€²è²¨é€šçŸ¥ã€‘\næ—¥æœŸï¼š${dateVal} (é€±${dayName})\n\né è¨ˆé€²è²¨å» å•†ï¼š\n- ${vendorText}\n\nè«‹ç›¸é—œäººå“¡ç•™æ„æ”¶è²¨ã€‚`;

        messageOutput.value = finalMessage;
    }

    // è¤‡è£½åŠŸèƒ½
    window.copyText = function() {
        messageOutput.select();
        messageOutput.setSelectionRange(0, 99999);
        
        try {
            navigator.clipboard.writeText(messageOutput.value).then(() => {
                showToast("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
            });
        } catch (err) {
            document.execCommand("copy");
            showToast("å·²è¤‡è£½ï¼");
        }
    }

    function showToast(msg) {
        const toast = document.getElementById("toast");
        toast.innerText = msg;
        toast.style.opacity = 1;
        setTimeout(() => {
            toast.style.opacity = 0;
        }, 2000);
    }
</script>

</body>
</html>
