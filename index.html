<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²è²¨é€šçŸ¥ (è‡ªå‹•è·³éé€±æ—¥)</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --primary: #007bff;   /* è—è‰² */
            --success: #28a745;   /* ç¶ è‰² */
            --danger: #dc3545;    /* ç´…è‰² */
            --bg: #f4f4f9;
            --card: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
            color: #333;
        }

        .container {
            background-color: var(--card);
            width: 100%;
            max-width: 500px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h2 {
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            color: #444;
        }

        .section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            color: #555;
        }

        /* --- æ—¥æœŸé¸æ“‡ --- */
        input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            background: #fff;
            box-sizing: border-box;
        }

        /* --- å» å•†åˆ—è¡¨å€ --- */
        .vendor-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .vendor-item input { display: none; }

        .vendor-item label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f0f2f5;
            padding: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
            min-height: 40px;
            border: 2px solid transparent;
            transition: 0.2s;
            position: relative;
            user-select: none;
            word-break: break-word;
        }

        .vendor-item input:checked + label {
            background-color: #e7f1ff;
            border-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }

        .del-btn {
            font-size: 10px;
            color: #aaa;
            margin-top: 4px;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(0,0,0,0.05);
        }
        .del-btn:hover { background: #ffdede; color: red; }

        /* --- æ–°å¢å€ --- */
        .add-box { display: flex; gap: 8px; }
        .add-box input {
            flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px;
        }
        .add-box button {
            background: var(--success); color: white; border: none; padding: 0 15px; border-radius: 6px; font-weight: bold; cursor: pointer;
        }

        /* --- è¨Šæ¯æ“ä½œå€ --- */
        textarea {
            width: 100%; 
            height: 250px; 
            padding: 12px; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
            font-size: 17px; 
            background-color: #fafafa; 
            resize: none; 
            box-sizing: border-box;
            line-height: 1.5;
        }

        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-big {
            padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; color: white; transition: opacity 0.2s;
        }
        .btn-big:active { opacity: 0.8; }
        .btn-copy { flex: 2; background-color: var(--primary); }
        .btn-clear { flex: 1; background-color: var(--danger); }

        /* --- èªªæ˜æ›¸å€å¡Š --- */
        .instructions {
            margin-top: 30px;
            border-top: 2px dashed #ddd;
            padding-top: 20px;
        }
        .instructions h3 {
            text-align: center; margin: 0 0 15px 0; font-size: 1.1rem; color: #666;
        }
        
        details {
            background-color: #f9f9f9;
            margin-bottom: 8px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #eee;
        }

        summary {
            padding: 12px;
            font-weight: bold;
            cursor: pointer;
            list-style: none;
            background-color: #ececec;
            color: #333;
            font-size: 14px;
        }
        summary::-webkit-details-marker { display: none; }
        summary::after {
            content: '+'; float: right; font-weight: bold;
        }
        details[open] summary::after { content: '-'; }

        .details-content {
            padding: 15px;
            font-size: 14px;
            color: #555;
            line-height: 1.6;
            border-top: 1px solid #ddd;
        }
        .details-content b { color: #000; }

        /* --- Toast --- */
        .toast {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: #fff; padding: 8px 20px; border-radius: 20px; font-size: 14px; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 999;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“… éš”æ—¥é€²è²¨é€šçŸ¥</h2>

    <!-- 1. æ—¥æœŸ -->
    <div class="section">
        <label>é€²è²¨æ—¥æœŸ (é è¨­æ˜å¤©ï¼Œé€±æ—¥è‡ªå‹•é †å»¶)</label>
        <input type="date" id="datePicker">
    </div>

    <!-- 2. å» å•†é¸å–® -->
    <div class="section">
        <label>é»æ“Šé¸æ“‡å» å•†ï¼š</label>
        <div class="vendor-list" id="vendorList">
            <!-- JS å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <div class="add-box">
            <input type="text" id="newVendorName" placeholder="è¼¸å…¥æ–°å» å•†åç¨±...">
            <button onclick="addCustomVendor()">ï¼‹ æ–°å¢ä¸¦å­˜æª”</button>
        </div>
    </div>

    <!-- 3. è¨Šæ¯é è¦½ -->
    <div class="section">
        <label>è¨Šæ¯é è¦½ï¼š</label>
        <textarea id="msgBox" readonly></textarea>

        <div class="btn-group">
            <button class="btn-big btn-clear" onclick="clearAll()">âŒ æ¸…é™¤</button>
            <button class="btn-big btn-copy" onclick="copyMsg()">ğŸ“‹ è¤‡è£½ LINE</button>
        </div>
    </div>

    <!-- 4. ç¶²ç«™æ“ä½œèªªæ˜æ›¸ -->
    <div class="instructions">
        <h3>ğŸ“– ç¶²ç«™æ“ä½œèªªæ˜</h3>
        
        <details>
            <summary>ğŸ‘‡ 1. å¦‚ä½•ç™¼é€é€²è²¨é€šçŸ¥</summary>
            <div class="details-content">
                1. <b>ç¢ºèªæ—¥æœŸ</b>ï¼šç³»çµ±é è¨­ç‚ºã€Œæ˜å¤©ã€ã€‚<br>
                (â€» è‹¥æ˜å¤©æ˜¯é€±æ—¥ï¼Œç³»çµ±æœƒè‡ªå‹•è·³æˆä¸‹é€±ä¸€)<br>
                2. <b>é¸æ“‡å» å•†</b>ï¼šé»æ“Šä¸Šæ–¹æŒ‰éˆ•ï¼Œè®Šè—è‰²ä»£è¡¨å·²é¸å–ã€‚<br>
                3. <b>è¤‡è£½è¨Šæ¯</b>ï¼šç¢ºèªæ–‡å­—ç„¡èª¤å¾Œï¼ŒæŒ‰è—è‰²ã€ŒğŸ“‹ è¤‡è£½ LINEã€ã€‚<br>
                4. <b>å‚³é€</b>ï¼šåˆ° LINE ç¾¤çµ„è²¼ä¸Šå³å¯ã€‚
            </div>
        </details>

        <details>
            <summary>ğŸ‘‡ 2. å¦‚ä½•æ–°å¢æˆ–åˆªé™¤å» å•†</summary>
            <div class="details-content">
                â— <b>æ–°å¢</b>ï¼šåœ¨è¼¸å…¥æ¡†æ‰“ä¸Šåå­—ï¼ŒæŒ‰ã€Œï¼‹ æ–°å¢ä¸¦å­˜æª”ã€ã€‚(ç³»çµ±æœƒè‡ªå‹•è¨˜éŒ„ï¼Œä¸‹æ¬¡é‚„åœ¨)<br><br>
                â— <b>åˆªé™¤</b>ï¼šä½ è‡ªå·±æ–°å¢çš„å» å•†ï¼ŒæŒ‰éˆ•ä¸‹æ–¹æœƒæœ‰ã€Œåˆªé™¤ã€å°å­—ï¼Œé»æ“Šå³å¯ç§»é™¤ã€‚<br>
                (â€» åŸæœ¬å›ºå®šçš„å» å•†ç„¡æ³•åˆªé™¤)
            </div>
        </details>

        <details>
            <summary>ğŸ‘‡ 3. æ¸…é™¤èˆ‡éš”æ—¥é‡ç½®</summary>
            <div class="details-content">
                â— <b>ä¸€éµæ¸…é™¤</b>ï¼šæŒ‰ç´…è‰²ã€ŒâŒ æ¸…é™¤ã€å¯å–æ¶ˆç•¶ä¸‹æ‰€æœ‰å‹¾é¸ã€‚<br><br>
                â— <b>éš”æ—¥è‡ªå‹•é‡ç½®</b>ï¼šä¸ç”¨æ‰‹å‹•å–æ¶ˆæ˜¨å¤©çš„å‹¾é¸ï¼Œ<b>éš”å¤©æ‰“é–‹ç¶²é æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•æ¸…ç©º</b>ï¼Œè®“ä½ ç›´æ¥é–‹å§‹æ–°çš„ä¸€å¤©ã€‚
            </div>
        </details>
    </div>

</div>

<div id="toast" class="toast">æç¤ºè¨Šæ¯</div>

<script>
    // ==============================================
    // 1. å›ºå®šå» å•†è¨­å®šå€ (è«‹åœ¨é€™è£¡åŠ å…¥ä¸è¦‹çš„å» å•†)
    // ==============================================
    const fixedVendors = [
        "å¦‚è¨˜", 
        "çµ±ä¸€å†°å“", 
        "è€é€Ÿè¡ŒéŠ·", 
        "æ³°å®‰", 
        "é—œåŒ—", 
        "ä¸­åŸ", 
        "é è³¼-äº‘å“", 
        "é è³¼-21ä¸–ç´€"
        // ä½ å¯ä»¥åœ¨é€™è£¡ç¹¼çºŒåŠ ï¼Œä¾‹å¦‚ï¼š "è›‹å•†", "å…æ´—é¤å…·"
    ];
    
    let customVendors = [];
    let selectedVendors = [];

    const elDate = document.getElementById('datePicker');
    const elList = document.getElementById('vendorList');
    const elMsg = document.getElementById('msgBox');
    const elInput = document.getElementById('newVendorName');

    window.onload = function() {
        initDate();        // 1. è¨­å®šæ—¥æœŸ (å«é€±æ—¥è·³é€±ä¸€é‚è¼¯)
        loadFromStorage(); // 2. è®€æª”
        render();          // 3. ç¹ªåœ–
        updateMsg();       // 4. æ›´æ–°æ–‡å­—
    };

    // â˜… æ—¥æœŸåˆå§‹åŒ–é‚è¼¯ (å«è‡ªå‹•è·³éé€±æ—¥)
    function initDate() {
        const d = new Date();
        d.setDate(d.getDate() + 1); // å…ˆåŠ  1 å¤© (è®Šæ˜å¤©)

        // æª¢æŸ¥ï¼šå¦‚æœé€™å¤©æ˜¯ æ˜ŸæœŸæ—¥ (getDay() == 0)
        if (d.getDay() === 0) {
            d.setDate(d.getDate() + 1); // å†åŠ  1 å¤© (è®Šæ˜ŸæœŸä¸€)
        }

        // æ ¼å¼åŒ–æˆ YYYY-MM-DD
        elDate.value = d.toISOString().split('T')[0];
    }

    function loadFromStorage() {
        const savedList = localStorage.getItem('my_custom_vendors_v3');
        if (savedList) customVendors = JSON.parse(savedList);

        const savedDate = localStorage.getItem('last_date');
        const savedChecks = localStorage.getItem('last_checks');
        
        if (savedDate === elDate.value && savedChecks) {
            selectedVendors = JSON.parse(savedChecks);
        } else {
            selectedVendors = [];
            saveToStorage();
        }
    }

    function saveToStorage() {
        localStorage.setItem('my_custom_vendors_v3', JSON.stringify(customVendors));
        localStorage.setItem('last_date', elDate.value);
        localStorage.setItem('last_checks', JSON.stringify(selectedVendors));
    }

    function render() {
        let html = '';
        const all = [...fixedVendors, ...customVendors];

        all.forEach(name => {
            const isChecked = selectedVendors.includes(name) ? 'checked' : '';
            const isCustom = !fixedVendors.includes(name);
            const delBtn = isCustom ? `<div class="del-btn" onclick="deleteVendor(event, '${name}')">åˆªé™¤</div>` : '';

            html += `
                <div class="vendor-item">
                    <input type="checkbox" id="v_${name}" value="${name}" ${isChecked} onchange="toggle('${name}')">
                    <label for="v_${name}">
                        <span>${name}</span>
                        ${delBtn}
                    </label>
                </div>
            `;
        });
        elList.innerHTML = html;
    }

    window.toggle = function(name) {
        if (selectedVendors.includes(name)) {
            selectedVendors = selectedVendors.filter(v => v !== name);
        } else {
            selectedVendors.push(name);
        }
        saveToStorage();
        updateMsg();
    }

    window.addCustomVendor = function() {
        const name = elInput.value.trim();
        if (!name) return showToast("è«‹è¼¸å…¥åç¨±");
        if (fixedVendors.includes(name) || customVendors.includes(name)) return showToast("å» å•†å·²å­˜åœ¨");

        customVendors.push(name);
        saveToStorage();
        elInput.value = '';
        render();
        showToast(`å·²æ–°å¢ï¼š${name}`);
    }

    window.deleteVendor = function(e, name) {
        e.preventDefault();
        if (!confirm(`ç¢ºå®šåˆªé™¤ã€Œ${name}ã€å—ï¼Ÿ`)) return;
        customVendors = customVendors.filter(v => v !== name);
        selectedVendors = selectedVendors.filter(v => v !== name);
        saveToStorage();
        render();
        updateMsg();
        showToast("å·²åˆªé™¤");
    }

    window.clearAll = function() {
        selectedVendors = [];
        saveToStorage();
        render(); 
        updateMsg();
        showToast("å·²å…¨éƒ¨æ¸…é™¤");
    }

    function updateMsg() {
        const dateStr = elDate.value;
        const dayName = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][new Date(dateStr).getDay()];
        const listText = selectedVendors.length > 0 ? selectedVendors.join('\n- ') : 'ç„¡';
        elMsg.value = `ã€é€²è²¨é€šçŸ¥ã€‘\næ—¥æœŸï¼š${dateStr} (é€±${dayName})\n\né è¨ˆé€²è²¨å» å•†ï¼š\n- ${listText}\n\nè«‹ç›¸é—œäººå“¡ç•™æ„æ”¶è²¨ã€‚`;
    }

    window.copyMsg = function() {
        elMsg.select();
        elMsg.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(elMsg.value)
            .then(() => showToast("è¤‡è£½æˆåŠŸï¼"))
            .catch(() => showToast("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½"));
    }

    elDate.addEventListener('change', function() {
        localStorage.setItem('last_date', elDate.value);
        updateMsg();
    });

    function showToast(text) {
        const t = document.getElementById('toast');
        t.textContent = text;
        t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 2000);
    }
</script>

</body>
</html>
